<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.089c4e8d70865e42a4a9.css" data-identity="gatsby-global-css">/*! tailwindcss v2.2.16 | MIT License | https://tailwindcss.com*/

/*! modern-normalize v1.1.0 | MIT License | https://github.com/sindresorhus/modern-normalize */html{-webkit-text-size-adjust:100%;line-height:1.15;-moz-tab-size:4;-o-tab-size:4;tab-size:4}body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;margin:0}hr{color:inherit;height:0}abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace,SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{border-color:inherit;text-indent:0}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,select{text-transform:none}[type=button],button{-webkit-appearance:button}legend{padding:0}progress{vertical-align:baseline}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}button{background-color:transparent;background-image:none}fieldset,ol,ul{margin:0;padding:0}ol,ul{list-style:none}html{font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;line-height:1.5}body{font-family:inherit;line-height:inherit}*,:after,:before{border:0 solid;box-sizing:border-box}hr{border-top-width:1px}img{border-style:solid}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{color:#a1a1aa;opacity:1}input:-ms-input-placeholder,textarea:-ms-input-placeholder{color:#a1a1aa;opacity:1}input::placeholder,textarea::placeholder{color:#a1a1aa;opacity:1}[role=button],button{cursor:pointer}table{border-collapse:collapse}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}button,input,optgroup,select,textarea{color:inherit;line-height:inherit;padding:0}code,kbd,pre,samp{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{height:auto;max-width:100%}[hidden]{display:none}*,:after,:before{border-color:currentColor}.static{position:static}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.top-0{top:0}.bottom-0{bottom:0}.left-0{left:0}.z-10{z-index:10}.z-20{z-index:20}.z-50{z-index:50}.m-3{margin:.75rem}.mx-2{margin-left:.5rem;margin-right:.5rem}.mx-3{margin-left:.75rem;margin-right:.75rem}.mx-5{margin-left:1.25rem;margin-right:1.25rem}.mx-auto{margin-left:auto;margin-right:auto}.my-2{margin-bottom:.5rem;margin-top:.5rem}.my-3{margin-bottom:.75rem;margin-top:.75rem}.my-4{margin-bottom:1rem;margin-top:1rem}.my-8{margin-bottom:2rem;margin-top:2rem}.mt-0{margin-top:0}.mt-1{margin-top:.25rem}.mt-3{margin-top:.75rem}.mt-4{margin-top:1rem}.mt-5{margin-top:1.25rem}.mt-8{margin-top:2rem}.mt-12{margin-top:3rem}.mt-20{margin-top:5rem}.mr-2{margin-right:.5rem}.mb-2{margin-bottom:.5rem}.mb-6{margin-bottom:1.5rem}.mb-12{margin-bottom:3rem}.ml-2{margin-left:.5rem}.ml-4{margin-left:1rem}.box-border{box-sizing:border-box}.block{display:block}.inline-block{display:inline-block}.flex{display:flex}.table{display:table}.hidden{display:none}.h-6{height:1.5rem}.h-8{height:2rem}.h-12{height:3rem}.h-64{height:16rem}.h-px{height:1px}.h-full{height:100%}.h-screen{height:100vh}.w-12{width:3rem}.w-16{width:4rem}.w-40{width:10rem}.w-auto{width:auto}.w-4\/5{width:80%}.w-full{width:100%}.max-w-none{max-width:none}.flex-1{flex:1 1 0%}.transform{--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;transform:translateX(var(--tw-translate-x)) translateY(var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.scale-0{--tw-scale-x:0;--tw-scale-y:0}.scale-100{--tw-scale-x:1;--tw-scale-y:1}@-webkit-keyframes spin{to{transform:rotate(1turn)}}@-webkit-keyframes ping{75%,to{opacity:0;transform:scale(2)}}@keyframes ping{75%,to{opacity:0;transform:scale(2)}}@-webkit-keyframes pulse{50%{opacity:.5}}@keyframes pulse{50%{opacity:.5}}@-webkit-keyframes bounce{0%,to{-webkit-animation-timing-function:cubic-bezier(.8,0,1,1);animation-timing-function:cubic-bezier(.8,0,1,1);transform:translateY(-25%)}50%{-webkit-animation-timing-function:cubic-bezier(0,0,.2,1);animation-timing-function:cubic-bezier(0,0,.2,1);transform:none}}@keyframes bounce{0%,to{-webkit-animation-timing-function:cubic-bezier(.8,0,1,1);animation-timing-function:cubic-bezier(.8,0,1,1);transform:translateY(-25%)}50%{-webkit-animation-timing-function:cubic-bezier(0,0,.2,1);animation-timing-function:cubic-bezier(0,0,.2,1);transform:none}}.resize-none{resize:none}.resize{resize:both}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.items-start{align-items:flex-start}.items-center{align-items:center}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.overflow-hidden{overflow:hidden}.whitespace-pre{white-space:pre}.rounded{border-radius:.25rem}.rounded-full{border-radius:9999px}.border-2{border-width:2px}.border-t-2{border-top-width:2px}.border-primary{--tw-border-opacity:1;border-color:rgba(71,87,110,var(--tw-border-opacity))}.border-secondary{--tw-border-opacity:1;border-color:rgba(62,62,62,var(--tw-border-opacity))}.hover\:border-primary:hover{--tw-border-opacity:1;border-color:rgba(71,87,110,var(--tw-border-opacity))}.bg-bg{background-color:rgba(248,248,248,var(--tw-bg-opacity))}.bg-bg,.bg-bgalt{--tw-bg-opacity:1}.bg-bgalt{background-color:rgba(255,255,255,var(--tw-bg-opacity))}.bg-cover{background-size:cover}.stroke-current{stroke:currentColor}.p-2{padding:.5rem}.p-3{padding:.75rem}.p-4{padding:1rem}.p-5{padding:1.25rem}.p-6{padding:1.5rem}.p-2px{padding:2px}.px-0{padding-left:0;padding-right:0}.px-3{padding-left:.75rem;padding-right:.75rem}.px-4{padding-left:1rem;padding-right:1rem}.px-6{padding-left:1.5rem;padding-right:1.5rem}.py-1{padding-bottom:.25rem;padding-top:.25rem}.py-2{padding-bottom:.5rem;padding-top:.5rem}.py-3{padding-bottom:.75rem;padding-top:.75rem}.py-5{padding-bottom:1.25rem;padding-top:1.25rem}.py-6{padding-bottom:1.5rem;padding-top:1.5rem}.py-12{padding-bottom:3rem;padding-top:3rem}.pt-1{padding-top:.25rem}.pt-3{padding-top:.75rem}.pt-4{padding-top:1rem}.pt-6{padding-top:1.5rem}.pt-8{padding-top:2rem}.pb-6{padding-bottom:1.5rem}.pb-20{padding-bottom:5rem}.pb-40{padding-bottom:10rem}.pl-2{padding-left:.5rem}.text-center{text-align:center}.align-middle{vertical-align:middle}.font-sans{font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji}.text-base{font-size:1rem;line-height:1.5rem}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-3xl{font-size:1.875rem;line-height:2.25rem}.text-5xl{font-size:3rem;line-height:1}.text-6xl{font-size:3.75rem;line-height:1}.text-7xl{font-size:5rem}.font-bold{font-weight:700}.uppercase{text-transform:uppercase}.text-color-default{--tw-text-opacity:1;color:rgba(62,62,62,var(--tw-text-opacity))}.text-color-1{--tw-text-opacity:1;color:rgba(71,87,110,var(--tw-text-opacity))}.text-color-2{--tw-text-opacity:1;color:rgba(116,164,188,var(--tw-text-opacity))}.text-color-3{--tw-text-opacity:1;color:rgba(242,101,34,var(--tw-text-opacity))}.text-color-4{--tw-text-opacity:1;color:rgba(62,62,62,var(--tw-text-opacity))}.text-primary{--tw-text-opacity:1;color:rgba(71,87,110,var(--tw-text-opacity))}.text-secondary{--tw-text-opacity:1;color:rgba(62,62,62,var(--tw-text-opacity))}.text-link{--tw-text-opacity:1;color:rgba(242,101,34,var(--tw-text-opacity))}.text-white{--tw-text-opacity:1;color:rgba(255,255,255,var(--tw-text-opacity))}.focus\:text-primary:focus{--tw-text-opacity:1;color:rgba(71,87,110,var(--tw-text-opacity))}*,:after,:before{--tw-shadow:0 0 #0000}.shadow{--tw-shadow:0 1px 3px 0 rgba(0,0,0,0.1),0 1px 2px 0 rgba(0,0,0,0.06)}.shadow,.shadow-xl{box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.shadow-xl{--tw-shadow:0 20px 25px -5px rgba(0,0,0,0.1),0 10px 10px -5px rgba(0,0,0,0.04)}.focus\:shadow-2xl:focus,.hover\:shadow-2xl:hover,.shadow-2xl{--tw-shadow:0 25px 50px -12px rgba(0,0,0,0.25);box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow)}.focus\:outline-none:focus,.outline-none{outline:2px solid transparent;outline-offset:2px}*,:after,:before{--tw-ring-inset:var(--tw-empty,/*!*/ /*!*/);--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgba(59,130,246,0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000}.filter{--tw-blur:var(--tw-empty,/*!*/ /*!*/);--tw-brightness:var(--tw-empty,/*!*/ /*!*/);--tw-contrast:var(--tw-empty,/*!*/ /*!*/);--tw-grayscale:var(--tw-empty,/*!*/ /*!*/);--tw-hue-rotate:var(--tw-empty,/*!*/ /*!*/);--tw-invert:var(--tw-empty,/*!*/ /*!*/);--tw-saturate:var(--tw-empty,/*!*/ /*!*/);--tw-sepia:var(--tw-empty,/*!*/ /*!*/);--tw-drop-shadow:var(--tw-empty,/*!*/ /*!*/);filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.transition-all{transition-duration:.15s;transition-property:all;transition-timing-function:cubic-bezier(.4,0,.2,1)}.transition-shadow{transition-duration:.15s;transition-property:box-shadow;transition-timing-function:cubic-bezier(.4,0,.2,1)}.transition-transform{transition-duration:.15s;transition-property:transform;transition-timing-function:cubic-bezier(.4,0,.2,1)}.duration-200{transition-duration:.2s}.duration-300{transition-duration:.3s}.theme-dark .bg-bg{background-color:#3e3e3e}.theme-dark .bg-bgalt{background-color:#000}.theme-dark .border-primary{border-color:#f8f8f8}.theme-dark .border-secondary{border-color:#fff}.theme-dark .text-color-default{color:#a8a8aa}.theme-dark .text-color-1,.theme-dark .text-primary{color:#f8f8f8}.theme-dark .text-secondary{color:#fff}.bg-gradient-primary{background-image:linear-gradient(90deg,#47576e,#3e3e3e)}.container{width:100%}@media (min-width:640px){.container{max-width:640px}}@media (min-width:768px){.container{max-width:768px}}@media (min-width:1024px){.container{max-width:1024px}}@media (min-width:1280px){.container{max-width:1280px}}@media (min-width:1536px){.container{max-width:1536px}}:root{--deckgo-highlight-code-carbon-toolbar-display:none;--deckgo-highlight-code-carbon-overflow:scroll;--deckgo-highlight-code-scroll:scroll;--deckgo-highlight-code-width:max-content;--deckgo-highlight-code-carbon-margin:30px 20px}body{font-family:Didact Gothic,sans-serif;font-size:18px}p{line-height:165%}.boxed{margin-left:auto;margin-right:auto;max-width:1024px;padding-left:1rem;padding-right:1rem;width:100%}.large-container{max-width:2100px}@media (min-width:1024px){.boxed{max-width:768px}}@media (min-width:1280px){.boxed{max-width:1024px}}.nav .nav-links li{display:inline-block;margin-left:.5rem;margin-right:.5rem;position:relative}.nav .nav-links li a{display:inline-block;padding:.25rem;position:relative;z-index:10}.nav .nav-links li:before{--tw-bg-opacity:1;background-color:rgba(71,87,110,var(--tw-bg-opacity));border-radius:9999px;bottom:0;content:"";height:0;left:0;margin:auto;opacity:.25;position:absolute;right:0;top:0;width:0}.theme-dark .nav .nav-links li:before{background-color:#f8f8f8}.nav .nav-links li:before{transition:width .25s,height .25s}.nav .nav-links li.active a,.nav .nav-links li:hover a{color:#f26522}.nav .nav-links .theme-switcher:before{display:none}.nav .line{transition:width .5s;width:0}.nav.scrolled .line{width:100%}.title h1{--tw-text-opacity:1;color:rgba(71,87,110,var(--tw-text-opacity))}.theme-dark .title h1{color:#f8f8f8}.btn{align-items:center;display:inline-flex;height:3rem;outline:2px solid transparent;outline-offset:2px;overflow:hidden;padding-left:1.5rem;padding-right:1.5rem;position:relative}.btn.disabled{opacity:.5}.btn span{position:relative;z-index:10}.btn:before{content:"";height:100%;left:100%;position:absolute;top:0;transition:left .25s;transition-timing-function:cubic-bezier(1,2.13,1,-.1);width:100%;z-index:1}.btn .icon-right{margin-left:.75rem}.btn .icon-left{margin-right:.75rem}.btn:focus{outline:2px solid transparent;outline-offset:2px}.btn-primary{--tw-bg-opacity:1;background-color:rgba(71,87,110,var(--tw-bg-opacity));margin-bottom:1rem;margin-top:1rem}.theme-dark .btn-primary{background-color:#f8f8f8}.btn-primary{color:#fff}.btn-primary:before{--tw-bg-opacity:1;background-color:rgba(62,62,62,var(--tw-bg-opacity))}.theme-dark .btn-primary:before{background-color:#fff}.btn-primary:focus:before,.btn-primary:hover:before{left:0}.integration-item .image{-webkit-clip-path:polygon(0 0,0 0,0 100%,0 100%);clip-path:polygon(0 0,0 0,0 100%,0 100%);transform:translateY(0);transition:-webkit-clip-path .5s;transition:clip-path .5s;transition:clip-path .5s,-webkit-clip-path .5s;transition-timing-function:ease-in-out;z-index:3}.integration-item.even .image{-webkit-clip-path:polygon(100% 0,100% 0,100% 99%,100% 100%);clip-path:polygon(100% 0,100% 0,100% 99%,100% 100%)}.integration-item.begin-animation .image{-webkit-clip-path:polygon(0 0,100% 0,100% 100%,0 100%);clip-path:polygon(0 0,100% 0,100% 100%,0 100%)}.integration-item .to-up{transform:translateY(50px);transition:transform .25s}.integration-item .to-up:nth-child(2){transition-delay:.2s}.integration-item.begin-animation .to-up{transform:translate(0)}.footer-links li{margin-left:.75rem;margin-right:.75rem}.animated-link-parent a{display:inline-block;position:relative}.animated-link-parent a:after{background-image:linear-gradient(90deg,#47576e,#3e3e3e);bottom:0;content:"";height:2px;left:0;position:absolute;transition-duration:.3s;transition-property:width;width:0}.animated-link-parent a:active:after,.animated-link-parent a:focus:after,.animated-link-parent a:hover:after{width:100%}.post-content p{margin-bottom:.75rem;margin-top:.75rem}.post-content h1,h2,h3,h4,h5,h6{--tw-text-opacity:1;color:rgba(116,164,188,var(--tw-text-opacity));margin-bottom:2rem;margin-top:2rem}.post-content h1{font-size:3rem;line-height:1}.post-content h2{font-size:2.25rem;line-height:2.5rem}.post-content h3{font-size:1.875rem;line-height:2.25rem}.post-content h4{font-size:1.5rem;line-height:2rem}.post-content h5{font-size:1.25rem;font-size:1.125rem;line-height:1.75rem}.post-content hr{--tw-border-opacity:1;border-color:rgba(207,216,220,var(--tw-border-opacity));margin-bottom:1rem;margin-top:1rem}.theme-dark .post-content hr{border-color:#222}.post-content ul{list-style:disc}.post-content ol{list-style:decimal}.post-content ol,.post-content ul{margin-left:1rem}.post-content ol ol,.post-content ul ul{margin-left:.75rem}.post-content li{margin-bottom:.5rem;margin-left:1.5rem;margin-top:.5rem}.post-content table{margin-bottom:1.5rem;margin-top:1.5rem;width:100%}.post-content table tr{--tw-border-opacity:1;border-bottom:2px solid #eee;border-bottom-color:rgba(207,216,220,var(--tw-border-opacity));border-left-color:rgba(207,216,220,var(--tw-border-opacity));border-right-color:rgba(207,216,220,var(--tw-border-opacity));border-top-color:rgba(207,216,220,var(--tw-border-opacity))}.theme-dark .post-content table tr{border-color:#222;border-bottom:2px solid #444}.post-content table tr td,.post-content table tr th{padding:.75rem .5rem;text-align:left}.post-content blockquote{--tw-border-opacity:1;border-color:rgba(71,87,110,var(--tw-border-opacity));border-left-width:4px;padding:.75rem}.theme-dark .post-content blockquote{border-color:#f8f8f8}.post-content blockquote{margin:1.5rem 0;padding:0 .75rem}.post-content iframe{max-width:100%}.input.focused{padding-left:1rem;padding-right:1rem}.theme-dark .blog-item .focused,.theme-dark .input.focused{background:#222}.spin{-webkit-animation:spin 1s linear infinite;animation:spin 1s linear infinite}@keyframes spin{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}@media (max-width:640px){html{font-size:15px}}.post-content a{--tw-text-opacity:1;color:rgba(116,164,188,var(--tw-text-opacity));margin-bottom:1rem;margin-top:1rem}.post-content pre{background-color:#333;color:#fff;margin:2rem;overflow:scroll;padding:1rem}.int-title{color:#fff!important}.integration-list{background-color:#fff;margin:30px auto auto;width:90%}.integration-list td{border:3px solid #f8f8f8;padding:8px 13px;vertical-align:top}.integration-list th{border:3px solid #f8f8f8;padding:10px}.int-desc{width:50%}.table-of-contents{background-color:#fff;float:right;margin:10px 0 10px 20px;padding:10px 0}.table-of-contents ol{counter-reset:tocnum;list-style:none;margin-left:0;padding-left:10px}.table-of-contents ol li{counter-increment:tocnum;line-height:100%;margin-left:10px;padding-left:0;padding-right:10px}.table-of-contents ol li:before{content:counters(tocnum,".") ". ";font-weight:700}code{background-color:#dedede;font-size:.85rem;padding:.25rem .5rem}h1,h2,h3,h4,h5,h6{margin-bottom:1.5rem;margin-top:1.5rem}@media (min-width:640px){.sm\:w-full{width:100%}}@media (min-width:768px){.md\:mt-6{margin-top:1.5rem}.md\:-mt-16{margin-top:-4rem}.md\:w-1\/2{width:50%}.md\:w-11\/12{width:91.666667%}.md\:w-full{width:100%}.md\:px-4{padding-left:1rem;padding-right:1rem}}@media (min-width:1024px){.lg\:relative{position:relative}.lg\:mt-12{margin-top:3rem}.lg\:box-content{box-sizing:content-box}.lg\:block{display:block}.lg\:flex{display:flex}.lg\:hidden{display:none}.lg\:h-auto{height:auto}.lg\:w-1\/2{width:50%}.lg\:w-1\/3{width:33.333333%}.lg\:w-2\/3{width:66.666667%}.lg\:w-3\/4{width:75%}.lg\:w-4\/5{width:80%}.lg\:w-full{width:100%}.lg\:justify-between{justify-content:space-between}.lg\:p-4{padding:1rem}.lg\:px-0{padding-left:0;padding-right:0}.lg\:py-14{padding-bottom:3.5rem;padding-top:3.5rem}.lg\:pt-0{padding-top:0}.lg\:pl-8{padding-left:2rem}.lg\:text-left{text-align:left}.lg\:text-lg{font-size:1.125rem;line-height:1.75rem}.lg\:text-xl{font-size:1.25rem;line-height:1.75rem}.lg\:text-4xl{font-size:2.25rem;line-height:2.5rem}.lg\:text-6xl{font-size:3.75rem;line-height:1}.lg\:text-7xl{font-size:5rem}.lg\:text-color-default{--tw-text-opacity:1;color:rgba(62,62,62,var(--tw-text-opacity))}.theme-dark .lg\:text-color-default{color:#a8a8aa}}</style><meta name="generator" content="Gatsby 3.14.1"/><title data-react-helmet="true">Backfilling Airflow DAGs using Marquez | OpenLineage</title><link data-react-helmet="true" rel="icon" href="/images/icon.svg" type="image/png"/><link data-react-helmet="true" href="https://fonts.googleapis.com/css2?family=Didact+Gothic&amp;display=swap" rel="stylesheet"/><meta data-react-helmet="true" name="description" content="In this blog post, we&#x27;ll discuss how lineage metadata can be used to automatically backfill DAGs with complex upstream and downstream dependencies."/><meta data-react-helmet="true" property="og:title" content="Backfilling Airflow DAGs using Marquez"/><meta data-react-helmet="true" property="og:description" content="In this blog post, we&#x27;ll discuss how lineage metadata can be used to automatically backfill DAGs with complex upstream and downstream dependencies."/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="@openlineage"/><meta data-react-helmet="true" name="twitter:title" content="Backfilling Airflow DAGs using Marquez"/><meta data-react-helmet="true" name="twitter:description" content="In this blog post, we&#x27;ll discuss how lineage metadata can be used to automatically backfill DAGs with complex upstream and downstream dependencies."/><meta data-react-helmet="true" property="og:image" content="/static/b98d2a39711777cfc5e77817b48c8f12/banner.svg"/><script data-react-helmet="true" defer="" data-domain="openlineage.io" src="https://plausible.io/js/script.outbound-links.js"></script><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-199717351-1', 'auto', {});
      
      
      
      
      
      }</script><link as="script" rel="preload" href="/webpack-runtime-5b8425aa72233c24487a.js"/><link as="script" rel="preload" href="/framework-c3c70a738d76c2aa5adb.js"/><link as="script" rel="preload" href="/app-451991c301b94b91c1ec.js"/><link as="script" rel="preload" href="/commons-edb969aabbc772eeb6fc.js"/><link as="script" rel="preload" href="/03af1e3b4838e2bf1feefdfdd4602b9a79f8e4c9-6dd2fc84b6bd0dd0e21b.js"/><link as="script" rel="preload" href="/component---src-templates-blog-tsx-ea74284cf1c1eab694cf.js"/><link as="fetch" rel="preload" href="/page-data/blog/backfilling-airflow-dags-using-marquez/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/1139857438.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/1946588481.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/2083862410.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/2213455283.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/2418326273.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3067102388.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="wrapper theme-light"><div class="text-color-default bg-bg"><div class="duration-300 transition-all flex justify-center lg:justify-between items-center z-20 fixed w-full nav p-5"><button class="absolute text-primary outline-0 lg:hidden" style="transform:translateY(-50%);top:50%;left:10px"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></button><div class="r-swipe-sidebar-container" style="position:absolute"><div class="r-swipe-sidebar" style="position:fixed;left:-100%;width:70%;height:100%;top:0;z-index:9999;transition-property:left;transition-duration:0s;transition-timing-function:linear;transform:translate3d(0,0,0)"><div class="bg-bg h-full flex flex-col justify-center relative"><div class="absolute top-0 my-4 text-center w-full"><a title="OpenLineage" class="inline-block" href="/"><img src="/images/ol-logo.svg" alt="OpenLineage - logo" class="duration-300 transition-all h-8"/></a></div><div class="text-center"><ul class=""><li class="block my-2 "><a title="Home" class="text-color-2 focus:text-primary" href="/"><span>Home</span></a></li><li class="block my-2 "><a title="Getting Started" class="text-color-2 focus:text-primary" href="/getting-started"><span>Getting Started</span></a></li><li class="block my-2 "><a title="Integrations" class="text-color-2 focus:text-primary" href="/integration"><span>Integrations</span></a></li><li class="block my-2 "><a title="Resources" class="text-color-2 focus:text-primary" href="/resources"><span>Resources</span></a></li><li class="block my-2 active"><a title="Blog" class="text-color-2 focus:text-primary" href="/blog"><span>Blog</span></a></li><li class="block my-2 "><a title="Ecosystem" class="text-color-2 focus:text-primary" href="/ecosystem"><span>Ecosystem</span></a></li><li class="block my-2 "><a title="Docs" class="text-color-2 focus:text-primary" href="/docs"><span>Docs</span></a></li></ul></div></div></div><div class="r-swipe-sidebar-overlay" role="button" tabindex="-1" style="position:fixed;top:0;bottom:0;left:-100%;width:100%;height:100%;background:#000;z-index:9998;transition-property:opacity;transition-duration:0s;opacity:0"></div></div><a title="OpenLineage" href="/"><img src="/images/ol-logo.svg" alt="OpenLineage - logo" class="duration-300 transition-all h-8"/></a><div class="hidden lg:block"><ul class="nav-links flex"><li class=" "><a title="Home" class="text-color-2 focus:text-primary" href="/"><span>Home</span></a></li><li class=" "><a title="Getting Started" class="text-color-2 focus:text-primary" href="/getting-started"><span>Getting Started</span></a></li><li class=" "><a title="Integrations" class="text-color-2 focus:text-primary" href="/integration"><span>Integrations</span></a></li><li class=" "><a title="Resources" class="text-color-2 focus:text-primary" href="/resources"><span>Resources</span></a></li><li class=" active"><a title="Blog" class="text-color-2 focus:text-primary" href="/blog"><span>Blog</span></a></li><li class=" "><a title="Ecosystem" class="text-color-2 focus:text-primary" href="/ecosystem"><span>Ecosystem</span></a></li><li class=" "><a title="Docs" class="text-color-2 focus:text-primary" href="/docs"><span>Docs</span></a></li></ul></div><div class="absolute line h-px left-0 bottom-0 bg-gradient-primary"></div></div><div style="height:0px"></div><div class="md:px-4 mt-12 py-6 md:w-11/12 mx-auto"><div class="mx-auto relative"><img src="/static/b98d2a39711777cfc5e77817b48c8f12/banner.svg" alt="&#x27;&#x27;"/><div class="relative w-full lg:w-3/4 md:w-11/12 sm:w-full p-6 box-border lg:box-content mx-auto bg-bg text-color-default blog-wall-content shadow-xl md:-mt-16 "><div class="p-3"><h1 class="text-5xl font-bold text-primary">Backfilling Airflow DAGs using Marquez</h1><p class="mt-1 flex"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg> <span class="ml-2">30 June 2021<!-- --> by <!-- -->Willy Lulciuc</span></p><p class="mt-3">In this blog post, we&#x27;ll discuss how lineage metadata can be used to automatically backfill DAGs with complex upstream and downstream dependencies.</p></div></div></div><div class="lg:w-3/4 md:w-11/12 sm:w-full p-3 mx-auto mt-12 post-content"><p>You&#x27;ve just deployed an Airflow <a href="https://airflow.apache.org/docs/apache-airflow/stable/concepts/dags.html#dags">DAG</a> that calculates the total sum of weekly food orders. You were able to identify what input tables to query, the frequency in which your DAG would run, and made sure analysts knew the resulting output table to use in their weekly food order trends report. The DAG only needs to run once a week, and with the DAG managed and scheduled via <a href="https://airflow.apache.org">Airflow</a>, you feel confident that the aggregated food order data will be available every Sunday morning for the weekly report.</p><p>As a developer, you&#x27;re monitoring your DAG for errors and after only a few DAG runs, you&#x27;re alerted that your DAG suddenly started to fail! Before you begin troubleshooting the root cause of the DAG failure, you notify the analytics team that the food order data will be incorrect for the week. After viewing the DAG error logs and a few email exchanges, you eventually discover that an upstream DAG had failed to write food order data for certain daily table partitions. Now, backfilling the missing data can be a manual and tedious task. As you sip your morning coffee, you think to yourself, <em>there must be a better way</em>. Yes, there is and collecting DAG lineage metadata would be a great start.</p><p>In this blog post, we&#x27;ll briefly introduce you to how backfills are handled in Airflow, then discuss how lineage metadata can be used to backfill DAGs with more complex upstream and downstream dependencies.</p><h2 id="1-brief-intro-to-backfilling-airflow-dags">1. Brief Intro to Backfilling Airflow DAGs</h2><p>Airflow supports <a href="https://airflow.apache.org/docs/apache-airflow/stable/dag-run.html#backfill">backfilling</a> DAG runs for a historical time window given a <em>start</em> and <em>end</em> date. Let&#x27;s say our <code>example.etl_orders_7_days</code> DAG started failing on <code>2021-06-06</code>, and we wanted to reprocess the daily table partitions for that week (assuming all partitions have been backfilled upstream). In order to run the backfill for <code>example.etl_orders_7_days</code>, using the Airflow <a href="https://airflow.apache.org/docs/apache-airflow/stable/cli-and-env-variables-ref.html">CLI</a>, you open up a terminal and execute the following <code>backfill</code> <a href="https://airflow.apache.org/docs/apache-airflow/stable/cli-and-env-variables-ref.html#backfill">command</a>:</p><deckgo-highlight-code terminal="carbon">
          <code slot="code"># Backfill weekly food orders
$ airflow dags backfill \
    --start-date 2021-06-06 \
    --end-date 2021-06-06 \
    example.etl_orders_7_days</code>
        </deckgo-highlight-code><p>Now, the backfill was fairly straightforward but they&#x27;re not always trivial. That is, we still have the following open questions: </p><ul><li>How quickly can data quality issues be identified and explored?</li><li>What alerting rules should be in place to notify downstream DAGs of possible upstream processing issues or failures?</li><li>What effects (if any) would upstream DAGs have on downstream DAGs if dataset consumption was delayed?</li></ul><p>Next, we&#x27;ll demonstrate how lineage metadata managed with <a href="https://marquezproject.ai">Marquez</a> can help answer some of these questions (and more!) by maintaining inter-DAG dependencies and cataloging historical runs of DAGs.</p><h2 id="2-exploring-lineage-metadata-using-marquez">2. Exploring Lineage Metadata using Marquez</h2><blockquote><p><strong>Note:</strong> To seed the Marquez HTTP API server with the sample lineage metadata used in this blog post, see the <a href="https://marquezproject.github.io/marquez/quickstart.html#write-sample-lineage-metadata-to-marquez">Write Sample Lineage Metadata to Marquez</a> section in Marquez&#x27;s <a href="https://marquezproject.github.io/marquez/quickstart.html">quickstart</a> guide.</p></blockquote><h4 id="21-collect-dag-lineage-metadata">2.1 COLLECT DAG LINEAGE METADATA</h4><p><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:639px;margin:3rem">
      <a class="gatsby-resp-image-link" href="/static/08305df7ce8d8e18ea01817b91d7fb78/738b8/lineage-graph.png" style="display:block" target="_blank" rel="noopener">
    <span class="gatsby-resp-image-background-image" style="padding-bottom:78.33333333333333%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAABdklEQVQ4y62Ty0rDQBSGk8nNpElMUo1JmppQN1JctYKIC0FxIUWlSxcWBUGkIIgrN2LBJxBd+BSC4JP4QL/MqTVtTWqlLg6ZOXPyzbn8IwiCgJ8mIt8/lWUbbz6AabizwEaBves3dDuPUFRpliyzzerKBpajOjRNgWVZ5BPFfDBjIlj+WbbZ3z7H1nq7X77nFcKmzrDbecLx4S1UTUa5vIAgCAgchiFM04Qsy1BVFUxScLpXx9FmrV9FETBcrMG1l2jNAc1mE41GA77vI45jlEol8lu2g4+XDl7vWl9tKQA+3Lzj6uwZc7pCEF3Xv8sfL813dHiWNrnkNF6DX05o7brF8hGn7eFJ+x6tnQuYlgFN0yY2n5cp/g7s4WD38v+EnWeSJNFk+TfLToSiKDT1QiA/rFQqJJXhV+I4DvkHQh/ERlFEsYyxfCC/MU1TChwX9PiUeX+TJCErBNq2TQFcb8MD4T8YhjFyCZdTtVqlzHk7/tTDv9onnstgLsGbkosAAAAASUVORK5CYII=&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="lineage graph" title="lineage graph" src="/static/08305df7ce8d8e18ea01817b91d7fb78/738b8/lineage-graph.png" srcSet="/static/08305df7ce8d8e18ea01817b91d7fb78/5a46d/lineage-graph.png 300w,/static/08305df7ce8d8e18ea01817b91d7fb78/0a47e/lineage-graph.png 600w,/static/08305df7ce8d8e18ea01817b91d7fb78/738b8/lineage-graph.png 639w" sizes="(max-width: 639px) 100vw, 639px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy" decoding="async"/>
  </a>
    </span></p><blockquote><p><strong>Figure 1:</strong> DAG lineage metadata.</p></blockquote><p><a href="https://marquezproject.ai">Marquez</a> is an open source metadata service for the collection, aggregation, and visualization of a data ecosystem’s metadata. Marquez has integration support for Airflow with minimal configuration. Using the <a href="https://github.com/MarquezProject/marquez/tree/main/integrations/airflow"><code>marquez-airflow</code></a> library, DAG lineage metadata will be collected automatically during DAG execution using the <a href="https://openlineage.io">OpenLineage</a> standard, then stored in Marquez’s centralized data model. To learn more about how lineage metadata is stored and versioned in Marquez, see the <a href="https://marquezproject.github.io/marquez/quickstart.html#marquez-data-model">Data Model</a> section in Marquez&#x27;s <a href="https://marquezproject.github.io/marquez/quickstart.html">quickstart</a> guide.</p><p>The Airflow integration gives us two important benefits:</p><ul><li><strong>DAG Metadata:</strong> Each DAG has a code version, inputs and outputs, run args, and run state transitions. Keeping a global historical log of DAG runs linked to code will quickly highlight upstream dependencies errors and minimize downstream impact.</li><li><strong>Lineage Metadata:</strong> Each DAG may have one or more upstream dependency. Keeping track of inter-DAG dependencies will allow for teams within an organization to safely depend on one another’s datasets, while also understanding which DAGs will be impacted downstream of a DAG failure.</li></ul><p>In this blog, we won&#x27;t go into how to enable lineage metadata collection for Airflow DAGs. But, we encourage you to take a look at Marquez&#x27;s Airflow <a href="https://github.com/MarquezProject/marquez/tree/main/examples/airflow">example</a> to learn how to troubleshoot DAG failures using Marquez.</p><h4 id="22-get-lineage-metadata-via-rest-api">2.2 GET LINEAGE METADATA VIA REST API</h4><p>In Marquez, each dataset and job has its own globally unique node ID that can be used to query the lineage graph. The <a href="https://marquezproject.github.io/marquez/openapi.html#tag/Lineage/paths/~1lineage/get">LineageAPI</a> returns a set of <strong>nodes</strong> consisting of <strong>edges</strong>. An edge is <strong>directed</strong> and has a defined <strong>origin</strong> and <strong>destination</strong>. A lineage graph may contain the following node types: <code>dataset:&lt;namespace&gt;:&lt;dataset&gt;</code>, <code>job:&lt;namespace&gt;:&lt;job&gt;</code>.</p><p>So, let&#x27;s start by querying the lineage graph for our <code>example.etl_orders_7_days</code> DAG using the node ID <code>job:food_delivery:example.etl_orders_7_days</code>. You&#x27;ll notice in the returned lineage graph that the DAG <em>input</em> datasets are <code>public.categories</code>, <code>public.orders</code>, and <code>public.menus</code> with <code>public.orders_7_days</code> as the <em>output</em> dataset:</p><h5 id="request">REQUEST</h5><deckgo-highlight-code terminal="carbon">
          <code slot="code">$ curl -X GET &quot;http://localhost:5000/api/v1-beta/lineage?nodeId=job:food_delivery:example.etl_orders_7_days&quot;</code>
        </deckgo-highlight-code><h5 id="response">RESPONSE</h5><p><code>200 OK</code></p><deckgo-highlight-code terminal="carbon">
          <code slot="code">{
  &quot;graph&quot;: [{
    &quot;id&quot;: &quot;job:food_delivery:example.etl_orders_7_days&quot;,
    &quot;type&quot;: &quot;JOB&quot;,
    &quot;data&quot;: {
      &quot;type&quot;: &quot;BATCH&quot;,
      &quot;id&quot;: {
        &quot;namespace&quot;: &quot;food_delivery&quot;,
        &quot;name&quot;: &quot;example.etl_orders_7_days&quot;
      },
      &quot;name&quot;: &quot;example.etl_orders_7_days&quot;,
      &quot;createdAt&quot;: &quot;2021-06-06T14:50:13.931946Z&quot;,
      &quot;updatedAt&quot;: &quot;2021-06-06T14:57:54.037399Z&quot;,
      &quot;namespace&quot;: &quot;food_delivery&quot;,
      &quot;inputs&quot;: [
        {&quot;namespace&quot;: &quot;food_delivery&quot;, &quot;name&quot;: &quot;public.categories&quot;},
        {&quot;namespace&quot;: &quot;food_delivery&quot;, &quot;name&quot;: &quot;public.menu_items&quot;},
        {&quot;namespace&quot;: &quot;food_delivery&quot;, &quot;name&quot;: &quot;public.orders&quot;},
        {&quot;namespace&quot;: &quot;food_delivery&quot;, &quot;name&quot;: &quot;public.menus&quot;}
      ],
      &quot;outputs&quot;: [
        {&quot;namespace&quot;: &quot;food_delivery&quot;, &quot;name&quot;: &quot;public.orders_7_days&quot;}
      ],
      &quot;location&quot;: &quot;https://github.com/example/jobs/blob/2294bc15eb49071f38425dc927e48655530a2f2e/etl_orders_7_days.py&quot;,
        &quot;context&quot;: {
          &quot;sql&quot;: &quot;INSERT INTO orders_7_days (order_id, placed_on, discount_id, menu_id, restaurant_id, menu_item_id, category_id)\n  SELECT o.id AS order_id, o.placed_on, o.discount_id, m.id AS menu_id, m.restaurant_id, mi.id AS menu_item_id, c.id AS category_id\n    FROM orders AS o\n   INNER JOIN menu_items AS mi\n      ON menu_items.id = o.menu_item_id\n   INNER JOIN categories AS c\n      ON c.id = mi.category_id\n   INNER JOIN menu AS m\n      ON m.id = c.menu_id\n   WHERE o.placed_on &gt;= NOW() - interval &#x27;7 days&#x27;;&quot;
        },
        &quot;description&quot;: &quot;Loads newly placed orders weekly.&quot;,
        &quot;latestRun&quot;: {
          &quot;id&quot;: &quot;5c7f0dc4-d3c1-4f16-9ac3-dc86c5da37cc&quot;,
          &quot;createdAt&quot;: &quot;2021-06-06T14:50:36.853459Z&quot;,
          &quot;updatedAt&quot;: &quot;2021-06-06T14:57:54.037399Z&quot;,
          &quot;nominalStartTime&quot;: &quot;2021-06-06T14:54:00Z&quot;,
          &quot;nominalEndTime&quot;: &quot;2021-06-06T14:57:00Z&quot;,
          &quot;state&quot;: &quot;FAILED&quot;,
          &quot;startedAt&quot;: &quot;2021-06-06T14:54:14.037399Z&quot;,
          &quot;endedAt&quot;: &quot;2021-06-06T14:57:54.037399Z&quot;,
          &quot;durationMs&quot;: 220000,
          &quot;args&quot;: {},
          &quot;location&quot;: &quot;https://github.com/example/jobs/blob/2294bc15eb49071f38425dc927e48655530a2f2e/etl_orders_7_days.py&quot;,
          &quot;context&quot;: {
            &quot;sql&quot;: &quot;INSERT INTO orders_7_days (order_id, placed_on, discount_id, menu_id, restaurant_id, menu_item_id, category_id)\n  SELECT o.id AS order_id, o.placed_on, o.discount_id, m.id AS menu_id, m.restaurant_id, mi.id AS menu_item_id, c.id AS category_id\n    FROM orders AS o\n   INNER JOIN menu_items AS mi\n      ON menu_items.id = o.menu_item_id\n   INNER JOIN categories AS c\n      ON c.id = mi.category_id\n   INNER JOIN menu AS m\n      ON m.id = c.menu_id\n   WHERE o.placed_on &gt;= NOW() - interval &#x27;7 days&#x27;;&quot;
          },
          &quot;facets&quot;: {}
        }
      },
      &quot;inEdges&quot;: [
        {&quot;origin&quot;: &quot;dataset:food_delivery:public.categories&quot;, &quot;destination&quot;: &quot;job:food_delivery:example.etl_orders_7_days&quot;}, &quot;destination&quot;: &quot;job:food_delivery:example.etl_orders_7_days&quot;},
        {&quot;origin&quot;: &quot;dataset:food_delivery:public.orders&quot;, &quot;destination&quot;: &quot;job:food_delivery:example.etl_orders_7_days&quot;},
        {&quot;origin&quot;: &quot;dataset:food_delivery:public.menus&quot;, &quot;destination&quot;: &quot;job:food_delivery:example.etl_orders_7_days&quot;}
      ],
      &quot;outEdges&quot;: [
        {&quot;origin&quot;: &quot;job:food_delivery:example.etl_orders_7_days&quot;, &quot;destination&quot;: &quot;dataset:food_delivery:public.orders_7_days&quot;}
      ]
    }
  }, ...]
}</code>
        </deckgo-highlight-code><h2 id="3-using-lineage-metadata-to-backfill-airflow-dags">3. Using Lineage Metadata to Backfill Airflow DAGs</h2><h4 id="31-backfilling">3.1 BACKFILLING</h4><p><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:843px;margin:3rem">
      <a class="gatsby-resp-image-link" href="/static/a499e994a1c2c7894c6d47b2f2ae0e53/4ff83/backfill.png" style="display:block" target="_blank" rel="noopener">
    <span class="gatsby-resp-image-background-image" style="padding-bottom:63%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAABW0lEQVQ4y61RvUrDUBi994aYUPublNYkNkljoBKHLtbBH7AZOriIWHBoRegm0kEQ0SfQByjUyWdwd3JR3Jx9DR/gyHerohVsqg6H73w/93yX7zDGGP4ZyQaFENBmVAjOIDiXUAQf5WLEpxIcgU+eMQwDhUIBpVIJ45xAPJ/Py9hqLKAb1xDX57HV8NGJa1iNLOyuh+jGi7CNWTDHceTDarWKcrmMdDqNMAzh+76sR1Ek45xl4XGwD9yf4mnYwfP1AXB3gtuLHbzcHAIPZ2hvhGC02TRNVCoVjHOC57lS0HYcHLdXcNVvor9dx/neMgZHm+i1Ilz21jDsN7HkmclvyDlPdsNpXNY1Dfzd5TdnP+dTu6woyu9/mMlkoOv6R65p2peceDabTSZIxpDLnudJIaqR+7SEbmlZFlzXRRAEsG0bqVTqZ0HanMvlpLuqqn7rF4tF2aM54hMF/4JXuNYwSPIKYeAAAAAASUVORK5CYII=&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="backfill" title="backfill" src="/static/a499e994a1c2c7894c6d47b2f2ae0e53/4ff83/backfill.png" srcSet="/static/a499e994a1c2c7894c6d47b2f2ae0e53/5a46d/backfill.png 300w,/static/a499e994a1c2c7894c6d47b2f2ae0e53/0a47e/backfill.png 600w,/static/a499e994a1c2c7894c6d47b2f2ae0e53/4ff83/backfill.png 843w" sizes="(max-width: 843px) 100vw, 843px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy" decoding="async"/>
  </a>
    </span></p><blockquote><p><strong>Figure 2:</strong> Backfilled daily table partitions.</p></blockquote><p>To run a backfill for <code>example.etl_orders_7_days</code> using the DAG lineage metadata stored in Marquez, we&#x27;ll need to query the lineage graph for the upstream DAG where the error originated. Now, let&#x27;s assume the <code>example.etl_orders</code> DAG upstream of <code>example.etl_orders_7_days</code> failed to write some of the daily table partitions needed for the weekly food order trends report (see <strong>Figure 2</strong>). To fix the weekly trends report, we&#x27;ll first need to backfill the missing daily table partitions <code>public.orders_2021_06_04</code>, <code>public.orders_2021_06_05</code>, and <code>public.orders_2021_06_06</code>:</p><deckgo-highlight-code terminal="carbon">
          <code slot="code"># Backfill daily food orders
$ airflow dags backfill \
    --start-date 2021-06-04 \
    --end-date 2021-06-06 \
    example.etl_orders</code>
        </deckgo-highlight-code><p><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:958px;margin:3rem">
      <a class="gatsby-resp-image-link" href="/static/0ca018fae7d14a84cd129c59edec6b7e/b97f6/inter-dag-deps.png" style="display:block" target="_blank" rel="noopener">
    <span class="gatsby-resp-image-background-image" style="padding-bottom:38.99999999999999%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABPUlEQVQoz51RTUvDQBDdhJiWkoQ0MYYlab42iXgIKvZQhEqrAatY9OBJ8QsPevDgxZMHr578y09mW4PFCuJhdmbfvHkzs8t6vR6yLEMYhqA4jmN4a6sIucDR+AaHoyscH9xht38Kx3Ekl3hBEEgu+SiKwDlHq9UCIzDP80YwTVNw7iPgApPRNerhhfSD7RPYdhdCCCRJ0oiSGNVQva7rYIwxOtBut2cd5vdlNi9ozDCMZTwG27ZRFAXKspQxYUlUYjycYlKfox6fYX9vilyUUBQFpmnKdauqgud5ElsQpNFJyLIsuK4rE4N+jZenD9xfvuL58R0Pt2+wTEfm0jSD7/tywi/+giB10TStARWFwen62Ch2IJIKRbaJdbGFTme2omlacspfnuYn+F38H7Y8oWkr8hPIq6oKxpQ/CX4CrGLCtjdSj3EAAAAASUVORK5CYII=&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="inter dag deps" title="inter dag deps" src="/static/0ca018fae7d14a84cd129c59edec6b7e/b97f6/inter-dag-deps.png" srcSet="/static/0ca018fae7d14a84cd129c59edec6b7e/5a46d/inter-dag-deps.png 300w,/static/0ca018fae7d14a84cd129c59edec6b7e/0a47e/inter-dag-deps.png 600w,/static/0ca018fae7d14a84cd129c59edec6b7e/b97f6/inter-dag-deps.png 958w" sizes="(max-width: 958px) 100vw, 958px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy" decoding="async"/>
  </a>
    </span></p><blockquote><p><strong>Figure 3:</strong> Airflow inter-DAG dependencies.</p></blockquote><p>Then, using the script <code>backfill.sh</code> defined below, we can easily backfill all DAGs downstream of <code>example.etl_orders</code>:</p><h5 id="backfillsh"><code>backfill.sh</code></h5><blockquote><p><strong>Note:</strong> Make sure you have <a href="https://stedolan.github.io/jq/download"><code>jq</code></a> installed before running <code>backfill.sh</code>. </p></blockquote><deckgo-highlight-code language="bash" terminal="carbon">
          <code slot="code">#!/bin/bash
#
# Backfill DAGs automatically using lineage metadata stored in Marquez.
#
# Usage: $ ./backfill.sh &lt;start-date&gt; &lt;end-date&gt; &lt;dag-id&gt;

set -e

# Backfills DAGs downstream of the given node ID, recursively.
backfill_downstream_of() {
  node_id=&quot;${1}&quot;
  # Get out edges for node ID
  out_edges=($(echo $lineage_graph \
    | jq -r --arg NODE_ID &quot;${node_id}&quot; &#x27;.graph[] | select(.id==$NODE_ID) | .outEdges[].destination&#x27;))
  for out_edge in &quot;${out_edges[@]}&quot;; do
    # Run backfill if out edge is a job node (i.e. &lt;dataset&gt; =&gt; &lt;job&gt;)
    if [[ &quot;${out_edge}&quot; = job:* ]]; then
      dag_id=&quot;${out_edge##*:}&quot;
      echo &quot;backfilling ${dag_id}...&quot;
      airflow backfill --start_date &quot;${start_date}&quot; --end_date &quot;${start_date}&quot; &quot;${dag_id}&quot;
    fi
    # Follow out edges downstream, recursively
    backfill_downstream_of &quot;${out_edge}&quot;
  done
}

start_date=&quot;${1}&quot;
end_date=&quot;${2}&quot;
dag_id=&quot;${3}&quot;

# (1) Build job node ID (format: &#x27;job:&lt;namespace&gt;:&lt;job&gt;&#x27;)
node_id=&quot;job:food_delivery:${dag_id}&quot;

# (2) Get lineage graph
lineage_graph=$(curl -s -X GET &quot;http://localhost:5000/api/v1-beta/lineage?nodeId=${node_id}&quot;)

# (3) Run backfill
backfill_downstream_of &quot;${node_id}&quot;</code>
        </deckgo-highlight-code><p>When you run the script <code>backfill.sh</code>, it will output all backfilled DAGs to the console:</p><deckgo-highlight-code terminal="carbon">
          <code slot="code">$ ./backfill.sh 2021-06-06 2021-06-06 example.etl_orders
backfilling example.etl_orders_7_days...
backfilling example.etl_delivery_7_days...
backfilling example.delivery_times_7_days...</code>
        </deckgo-highlight-code><h2 id="4-conclusion">4. Conclusion</h2><p>In this blog post, we showed how easy it can be to automate backfilling DAGs downstream of a data quality issue using lineage metadata stored in Marquez. With only two steps, we were able to backfill missing daily table partitions, then automatically re-run failed DAGs downstream of the upstream DAG where the error originated. But, what measures can we put in place to detect low-quality data issues faster, therefore avoiding backfills altogether? Since Marquez collects DAG run metadata that can be viewed using the <a href="https://marquezproject.github.io/marquez/openapi.html#tag/Jobs/paths/~1jobs~1runs~1%7Bid%7D/get">Runs API</a>, building automated processes that periodically check DAG run states and quickly notifying teams of upstream data quality issue (or missed SLAs) in a timely fashion is just one possible preventive measure.</p><p>We encourge you to explore Marquez&#x27;s opinionated <a href="https://marquezproject.github.io/marquez/openapi.html">Metadata API</a> and define your own automated process(es) for analyzing lineage metadata! If you need help or have any questions, you can always join our <a href="http://bit.ly/MarquezSlack">Slack</a> channel or reach out to us on <a href="https://twitter.com/MarquezProject">Twitter</a>.</p></div></div><footer class="footer bg-bgalt py-12"><div class="container mx-auto text-center"><div class="flex justify-center my-3 mb-6"><a title="OpenLineage" href="/"><img src="/images/ol-logo.svg" alt="OpenLineage - logo" class="w-40"/></a></div><div class="text-color-2 my-3 footer-links animated-link-parent"><ul class="flex items-center justify-center flex-wrap"><li class=" "><a title="Home" class="text-color-2 focus:text-primary" href="/"><span>Home</span></a></li><li class=" "><a title="Getting Started" class="text-color-2 focus:text-primary" href="/getting-started"><span>Getting Started</span></a></li><li class=" "><a title="Integrations" class="text-color-2 focus:text-primary" href="/integration"><span>Integrations</span></a></li><li class=" "><a title="Resources" class="text-color-2 focus:text-primary" href="/resources"><span>Resources</span></a></li><li class=" "><a title="Blog" class="text-color-2 focus:text-primary" href="/blog"><span>Blog</span></a></li><li class=" "><a title="Ecosystem" class="text-color-2 focus:text-primary" href="/ecosystem"><span>Ecosystem</span></a></li><li class=" "><a title="Docs" class="text-color-2 focus:text-primary" href="/docs"><span>Docs</span></a></li></ul></div><div class="text-color-2 my-3"><ul><li class="inline-block mx-3 animated-link-parent"><a href="https://twitter.com/OpenLineage" title="Twitter"><span>Twitter</span></a></li><li class="inline-block mx-3 animated-link-parent"><a href="http://bit.ly/OpenLineageSlack" title="Slack"><span>Slack</span></a></li><li class="inline-block mx-3 animated-link-parent"><a href="https://github.com/OpenLineage/OpenLineage" title="GitHub"><span>GitHub</span></a></li></ul></div><p class="text-color-default text-lg">Copyright © <!-- -->2022<!-- --> The Linux Foundation®. All rights reserved.</p></div></footer></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/backfilling-airflow-dags-using-marquez/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-b5a5dbb1060cd6f20f46.js"],"app":["/app-451991c301b94b91c1ec.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-9f423a0461078a54f8ef.js"],"component---src-pages-contact-tsx":["/component---src-pages-contact-tsx-144c2cbcdce5dce15a6e.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-82a1131f931451bbaa5a.js"],"component---src-templates-basepages-tsx":["/component---src-templates-basepages-tsx-81225bbcb5c10501d181.js"],"component---src-templates-blog-list-tsx":["/component---src-templates-blog-list-tsx-31d83b2f6394db868c0e.js"],"component---src-templates-blog-tsx":["/component---src-templates-blog-tsx-ea74284cf1c1eab694cf.js"],"component---src-templates-integration-list-tsx":["/component---src-templates-integration-list-tsx-27189bf1afa810bbd594.js"],"component---src-templates-integration-tsx":["/component---src-templates-integration-tsx-7f35005c2787bfe3c74d.js"]};/*]]>*/</script><script src="/polyfill-b5a5dbb1060cd6f20f46.js" nomodule=""></script><script src="/component---src-templates-blog-tsx-ea74284cf1c1eab694cf.js" async=""></script><script src="/03af1e3b4838e2bf1feefdfdd4602b9a79f8e4c9-6dd2fc84b6bd0dd0e21b.js" async=""></script><script src="/commons-edb969aabbc772eeb6fc.js" async=""></script><script src="/app-451991c301b94b91c1ec.js" async=""></script><script src="/framework-c3c70a738d76c2aa5adb.js" async=""></script><script src="/webpack-runtime-5b8425aa72233c24487a.js" async=""></script></body></html>